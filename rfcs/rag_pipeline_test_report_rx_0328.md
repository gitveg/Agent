# 20250328 RAG流程测试报告

## 测试目标
示例：测试RAG系统整体流程，排查其中可能存在的问题，并且写下case分析和拟优化方案

## 测试记录

基座模型：Qwen/Qwen2.5-7B-Instruct

### PDF 输入测试记录

采用 RISC-V 官方文档 riscv-privileged.pdf 作为测试文档进行测试，产生 list index out of range 问题。尝试进行问题排查，未成功，列入稍后工作。

### TXT 输入测试记录

短 txt 文档测试：

采用朱自清《荷塘月色》作为测试文档。知识库建立、文档上传，RAG问答流程正常。

| 输入Query |   输出 Response |  存在的问题 |
|-----------| ---------------| ---------- |
|“荡舟心许”出自谁的诗？|"根据参考信息，“荡舟心许”出自《西洲曲》中的句子。|误将后文提到另一首诗标题作为当前诗标题，疑似因分块位置及重排序顺序所致|
|作者是什么时候去散步的？|根据参考信息，作者是晚上在院子里散步的。具体时间描述为“这几天心里颇不宁静。今晚在院子里坐着乘凉，忽然想起日日走过的荷塘，在这满月的光里，总该另有一番样子吧。”从中可以推断，作者是在一个满月的晚上散步的。|部分正确，没有答到一九二七年这个大时间点。查看检索得到的块，“一九二七年”所在块排相关度第三位，可能为模型能力限制所致。|
|作者将荷花比作什么？|According to the reference information,作者将荷花比作亭亭的舞女的裙、一粒粒的明珠、碧天里的星星、刚出浴的美人。\\n\\n具体来说，原文中有以下描述：\\n- “叶子出水很高，像亭亭的舞女的裙。”\\n- “正如一粒粒的明珠，又如碧天里的星星，又如刚出浴的美人。”\\n这些比喻形象地描绘了荷花的美丽姿态和光彩。|存在中英文混杂和查询理解错误的问题。误将对叶子的描述理解为对荷花的描述。|

长 txt 文档测试：

采用 RISC-V 官方文档 riscv-privileged.pdf 简单转换得到的 riscv-privileged.txt 作为测试文档。共10867行。知识库建立正常。调用接口进行文档上传及解析时出现 Failed to upload file (HTTP 503): 503 — Service Unavailable 问题，为 Response Timeout 所致，但文档成功上传并分片，未影响后续测试流程。RAG问答流程正常。

| 输入Query |   输出 Response |  存在的问题 |
|-----------| ---------------| ---------- |
|RISC-V架构中定义了哪几种特权级别？|According to the reference information, RISC-V架构中定义了三种特权级别，分别是：\n\n- **User/Application (U)**：用户或应用级别。\n- **Supervisor (S)**：监督器级别。\n- **Machine (M)**：机器级别。\n\n这些特权级别用于在软件堆栈的不同组件之间提供保护，并且尝试执行当前特权模式不允许的操作将引发异常，这些异常通常会导致进入较低的特权执行环境。|存在中英文混杂问题。|
|mstatus寄存器中的MIE和SIE位有什么作用？|According to the reference information, mstatus寄存器中的MIE和SIE位的作用如下：\n\n- **MIE位**：MIE位位于mstatus寄存器的低8位，用于控制M-mode（机器模式）的全局中断使能。当MIE为1时，M-mode的中断全局使能；当MIE为0时，M-mode的中断全局禁止。对于更高特权模式的中断，它们始终处于全局使能状态，不受任何全局中断使能位的影响。\n- **SIE位**：SIE位同样位于mstatus寄存器的低8位，用于控制S-mode（监督模式）的全局中断使能。当SIE为1时，S-mode的中断全局使能；当SIE为0时，S-mode的中断全局禁止。对于更低特权模式的中断，它们始终处于全局禁止状态，不受任何全局中断使能位的影响。\n\n### 摘要\n- **MIE位和SIE位**的主要作用是确保在当前特权模式下的中断处理程序的原子性。\n- 这些位可以通过单一的CSR指令原子地设置或清除，从而确保中断处理的高效性和一致性。|存在中英文混杂问题，存在表述问题。|
|mcause寄存器如何表示异常和中断？|Error code: 503 - {'code': 50508, 'message': 'System is too busy now. Please try again later.', 'data': None}|测试失败，系统过于繁忙。由于本次测试通过远程API调用外部模型进行，未占用系统计算资源，考虑排查代码原因。|

## 存在的问题总结

- PDF 未成功解析：需要排查系统中存在的 bug 并修正。
- 长 TXT 上传异常：可能是网络通信中延时设置问题。需要排查系统代码设置。
- 系统繁忙：问题同上。
- 输出中英文混杂：可能是RAG系统基座模型参数量过小原因。考虑采用参数量更大的模型。
- 查询输出事实错误：问题同上，检索和重排序给出的文本块正确，考虑为模型理解能力问题。
- 输出忽略部分事实：问题同上。

## 优化的思路

- 排查现有代码，修正导致 PDF 无法解析和 TXT 较长时返回错误的问题。
- 更换基座模型，比较模型能力。